<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Trading App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-bg': '#0f172a',
                        'dark-card': '#1e293b',
                        'dark-border': '#334155',
                        'accent-cyan': '#06b6d4',
                        'accent-blue': '#3b82f6',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .module-hidden { display: none !important; }
        .nav-active { background-color: #06b6d4; color: white; }
    </style>
</head>
<body class="bg-dark-bg text-white">

<!-- Auth Modal -->
<div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50">
    <div class="bg-dark-card border border-dark-border rounded-2xl p-8 max-w-md w-full mx-4">
        <div class="flex items-center gap-3 mb-6">
            <div class="bg-accent-cyan p-2 rounded-lg">
                <span class="material-symbols-outlined text-2xl">account_circle</span>
            </div>
            <h2 class="text-2xl font-bold">AI Trading App</h2>
        </div>

        <!-- Tabs -->
        <div class="flex mb-6 bg-dark-bg rounded-lg p-1">
            <button id="tab-login" onclick="switchAuthTab('login')" class="flex-1 py-2 px-4 rounded-md bg-accent-cyan text-white font-medium transition">
                Iniciar Sesi칩n
            </button>
            <button id="tab-register" onclick="switchAuthTab('register')" class="flex-1 py-2 px-4 rounded-md text-gray-400 font-medium transition hover:text-white">
                Registrarse
            </button>
        </div>

        <!-- Login Form -->
        <div id="form-login" class="space-y-4">
            <div>
                <label class="text-gray-300 text-sm font-medium block mb-2">Usuario o Email</label>
                <input id="login-username" type="text" placeholder="Ingresa tu usuario o email" class="w-full bg-dark-bg text-white rounded-lg px-4 py-3 border border-dark-border focus:border-accent-cyan focus:outline-none transition"/>
            </div>
            <div>
                <label class="text-gray-300 text-sm font-medium block mb-2">Contrase침a</label>
                <input id="login-password" type="password" placeholder="Ingresa tu contrase침a" class="w-full bg-dark-bg text-white rounded-lg px-4 py-3 border border-dark-border focus:border-accent-cyan focus:outline-none transition"/>
            </div>
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <input id="keep-session" type="checkbox" class="w-4 h-4 text-accent-cyan bg-dark-bg border-dark-border rounded focus:ring-accent-cyan focus:ring-2"/>
                    <label for="keep-session" class="ml-2 text-sm text-gray-300">Mantener sesi칩n iniciada (15 d칤as)</label>
                </div>
                <button onclick="showForgotPassword()" class="text-sm text-accent-cyan hover:text-cyan-400 transition">
                    쯆lvidaste tu contrase침a?
                </button>
            </div>
            <button onclick="loginUser()" class="w-full bg-accent-cyan hover:bg-cyan-600 text-white font-bold py-3 px-4 rounded-lg transition">
                Iniciar Sesi칩n
            </button>
            <div id="login-message" class="text-sm text-center hidden"></div>
        </div>

        <!-- Register Form -->
        <div id="form-register" class="space-y-4 hidden">
            <div>
                <label class="text-gray-300 text-sm font-medium block mb-2">Nombre de Usuario</label>
                <input id="register-username" type="text" placeholder="Elige un nombre de usuario" class="w-full bg-dark-bg text-white rounded-lg px-4 py-3 border border-dark-border focus:border-accent-cyan focus:outline-none transition"/>
            </div>
            <div>
                <label class="text-gray-300 text-sm font-medium block mb-2">Email</label>
                <input id="register-email" type="email" placeholder="tu@email.com" class="w-full bg-dark-bg text-white rounded-lg px-4 py-3 border border-dark-border focus:border-accent-cyan focus:outline-none transition"/>
            </div>
            <div>
                <label class="text-gray-300 text-sm font-medium block mb-2">Contrase침a</label>
                <input id="register-password" type="password" placeholder="M칤nimo 8 caracteres" class="w-full bg-dark-bg text-white rounded-lg px-4 py-3 border border-dark-border focus:border-accent-cyan focus:outline-none transition"/>
            </div>
            <div>
                <label class="text-gray-300 text-sm font-medium block mb-2">Confirmar Contrase침a</label>
                <input id="register-confirm-password" type="password" placeholder="Repite tu contrase침a" class="w-full bg-dark-bg text-white rounded-lg px-4 py-3 border border-dark-border focus:border-accent-cyan focus:outline-none transition"/>
            </div>
            <button onclick="registerUser()" class="w-full bg-accent-cyan hover:bg-cyan-600 text-white font-bold py-3 px-4 rounded-lg transition">
                Crear Cuenta
            </button>
            <div id="register-message" class="text-sm text-center hidden"></div>
        </div>

        <!-- Forgot Password Form -->
        <div id="form-forgot-password" class="space-y-4 hidden">
            <div class="flex items-center gap-2 mb-4">
                <button onclick="switchAuthTab('login')" class="text-gray-400 hover:text-white">
                    <span class="material-symbols-outlined">arrow_back</span>
                </button>
                <h3 class="text-lg font-semibold">Recuperar Contrase침a</h3>
            </div>
            <p class="text-sm text-gray-400 mb-4">Ingresa tu email y te enviaremos un c칩digo de verificaci칩n.</p>
            <div>
                <label class="text-gray-300 text-sm font-medium block mb-2">Email</label>
                <input id="forgot-email" type="email" placeholder="tu@email.com" class="w-full bg-dark-bg text-white rounded-lg px-4 py-3 border border-dark-border focus:border-accent-cyan focus:outline-none transition"/>
            </div>
            <button onclick="sendRecoveryCode()" class="w-full bg-accent-cyan hover:bg-cyan-600 text-white font-bold py-3 px-4 rounded-lg transition">
                Enviar C칩digo
            </button>
            <div id="forgot-message" class="text-sm text-center hidden"></div>
        </div>
    </div>
</div>

<!-- Main App -->
<div id="main-app" class="hidden min-h-screen">
    <!-- Top Header -->
    <header class="bg-[#1a1f2e] border-b border-dark-border sticky top-0 z-50">
        <div class="px-8 py-4 flex items-center justify-between">
            <!-- Logo and Title -->
            <div class="flex items-center gap-3">
                <div class="bg-accent-cyan p-2 rounded-lg">
                    <span class="material-symbols-outlined text-xl">database</span>
                </div>
                <h1 class="text-xl font-bold">AI Trading App</h1>
            </div>

            <!-- Navigation Tabs -->
            <nav class="flex gap-1">
                <button onclick="showModule('dashboard')" class="nav-tab px-6 py-2 rounded-t-lg font-medium transition nav-active" data-module="dashboard">
                    Dashboard
                </button>
                <button onclick="showModule('bot')" class="nav-tab px-6 py-2 rounded-t-lg font-medium text-gray-400 hover:text-white transition" data-module="bot">
                    Bot
                </button>
                <button onclick="showModule('backtest')" class="nav-tab px-6 py-2 rounded-t-lg font-medium text-gray-400 hover:text-white transition" data-module="backtest">
                    Backtest
                </button>
                <button onclick="showModule('config')" class="nav-tab px-6 py-2 rounded-t-lg font-medium text-gray-400 hover:text-white transition" data-module="config">
                    Configuraci칩n
                </button>
            </nav>

            <!-- Right Side: Connection Status + ID + Avatar -->
            <div class="flex items-center gap-4">
                <div id="topstep-header-indicator" class="flex items-center gap-2 hidden">
                    <div id="topstep-header-dot" class="w-2 h-2 bg-red-500 rounded-full"></div>
                    <span id="topstep-header-text" class="text-sm text-gray-300">Desconectado</span>
                </div>

                <!-- Selector de cuenta -->
                <div class="relative">
                    <button id="account-selector-btn" onclick="toggleAccountSelector()" class="flex items-center gap-2 text-sm text-gray-300 hover:text-white px-3 py-1 rounded hover:bg-dark-border transition">
                        <span id="current-account-name">Sin cuenta</span>
                        <span class="material-symbols-outlined text-sm">expand_more</span>
                    </button>

                    <!-- Dropdown de cuentas -->
                    <div id="account-selector-dropdown" class="hidden absolute top-full right-0 mt-2 w-80 bg-dark-card border border-dark-border rounded-lg shadow-xl z-50 max-h-96 overflow-y-auto">
                        <div class="p-3 border-b border-dark-border">
                            <h3 class="text-sm font-bold text-white">Cuentas Activas</h3>
                            <p class="text-xs text-gray-400 mt-1">Selecciona una cuenta para ver sus datos</p>
                        </div>
                        <div id="account-list" class="p-2">
                            <!-- Lista de cuentas se carga din치micamente -->
                        </div>
                    </div>
                </div>

                <button onclick="errorNotificationSystem.toggleNotificationPanel()" class="text-gray-400 hover:text-white relative">
                    <span class="material-symbols-outlined">notifications</span>
                    <span id="notification-badge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold">0</span>
                </button>
                <button onclick="logoutUser()" class="text-gray-400 hover:text-red-400 transition" title="Cerrar sesi칩n">
                    <span class="material-symbols-outlined">logout</span>
                </button>
                <div class="w-10 h-10 bg-gradient-to-br from-orange-400 to-pink-400 rounded-full"></div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="p-8">
        <!-- Dashboard Module -->
        <div id="module-dashboard" class="module-visible">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-dark-card border border-dark-border rounded-xl p-6">
                    <p class="text-gray-400 text-sm mb-2">Saldo de la Cuenta</p>
                    <p id="balance" class="text-3xl font-bold">$0.00</p>
                </div>
                <div class="bg-dark-card border border-dark-border rounded-xl p-6">
                    <p class="text-gray-400 text-sm mb-2">Ganancias del D칤a</p>
                    <p id="daily-pnl" class="text-3xl font-bold text-gray-400">$0.00</p>
                </div>
                <div class="bg-dark-card border border-dark-border rounded-xl p-6">
                    <p class="text-gray-400 text-sm mb-2">Win Rate</p>
                    <p id="win-rate" class="text-3xl font-bold">0%</p>
                </div>
                <div class="bg-dark-card border border-dark-border rounded-xl p-6">
                    <p class="text-gray-400 text-sm mb-2">Max Drawdown</p>
                    <p id="max-drawdown" class="text-3xl font-bold text-gray-400">-$0.00</p>
                </div>
            </div>

            <!-- Active Positions -->
            <div class="bg-dark-card border border-dark-border rounded-xl p-6 mb-8">
                <h2 class="text-2xl font-bold mb-6">Traders Activos</h2>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-left text-gray-400 text-sm border-b border-dark-border">
                                <th class="pb-4 font-medium">Symbol</th>
                                <th class="pb-4 font-medium">Quantity</th>
                                <th class="pb-4 font-medium">Entry Price</th>
                                <th class="pb-4 font-medium">Current Price</th>
                                <th class="pb-4 font-medium">P&L</th>
                                <th class="pb-4 font-medium">Action</th>
                            </tr>
                        </thead>
                        <tbody id="positions-table" class="text-sm">
                            <tr>
                                <td colspan="6" class="py-8 text-center text-gray-400">Cargando posiciones...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Trade History -->
            <div class="bg-dark-card border border-dark-border rounded-xl p-6">
                <h2 class="text-2xl font-bold mb-6">Historial de Traders Realizados</h2>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-left text-gray-400 text-sm border-b border-dark-border">
                                <th class="pb-4 font-medium">Symbol</th>
                                <th class="pb-4 font-medium">Type</th>
                                <th class="pb-4 font-medium">Quantity</th>
                                <th class="pb-4 font-medium">Entry Price</th>
                                <th class="pb-4 font-medium">Close Price</th>
                                <th class="pb-4 font-medium">P&L</th>
                                <th class="pb-4 font-medium">Date</th>
                            </tr>
                        </thead>
                        <tbody id="history-table" class="text-sm">
                            <tr>
                                <td colspan="7" class="py-8 text-center text-gray-400">Cargando historial...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Bot Module -->
        <div id="module-bot" class="module-hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Left Column -->
                <div class="space-y-6">
                    <!-- Trading Schedule -->
                    <div class="bg-dark-card border border-dark-border rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4">Horario y d칤as de trading</h3>

                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="text-gray-400 text-sm block mb-2">Hora de inicio de b칰squeda</label>
                                <div class="relative">
                                    <input type="time" id="start-time" value="09:30" class="w-full bg-dark-bg text-white rounded-lg px-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none"/>
                                    <span class="material-symbols-outlined absolute right-3 top-2 text-gray-400">schedule</span>
                                </div>
                            </div>
                            <div>
                                <label class="text-gray-400 text-sm block mb-2">Hora de fin de b칰squeda</label>
                                <div class="relative">
                                    <input type="time" id="end-time" value="16:00" class="w-full bg-dark-bg text-white rounded-lg px-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none"/>
                                    <span class="material-symbols-outlined absolute right-3 top-2 text-gray-400">schedule</span>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="text-gray-400 text-sm block mb-3">D칤as de trading</label>
                            <div class="flex gap-2">
                                <button id="day-1" onclick="toggleTradingDay(1)" class="w-12 h-12 rounded-lg bg-accent-cyan text-white font-semibold transition" data-active="true">L</button>
                                <button id="day-2" onclick="toggleTradingDay(2)" class="w-12 h-12 rounded-lg bg-accent-cyan text-white font-semibold transition" data-active="true">M</button>
                                <button id="day-3" onclick="toggleTradingDay(3)" class="w-12 h-12 rounded-lg bg-dark-bg text-gray-400 font-semibold hover:bg-dark-border transition" data-active="false">X</button>
                                <button id="day-4" onclick="toggleTradingDay(4)" class="w-12 h-12 rounded-lg bg-accent-cyan text-white font-semibold transition" data-active="true">J</button>
                                <button id="day-5" onclick="toggleTradingDay(5)" class="w-12 h-12 rounded-lg bg-accent-cyan text-white font-semibold transition" data-active="true">V</button>
                                <button id="day-6" onclick="toggleTradingDay(6)" class="w-12 h-12 rounded-lg bg-dark-bg text-gray-400 font-semibold hover:bg-dark-border transition" data-active="false">S</button>
                                <button id="day-0" onclick="toggleTradingDay(0)" class="w-12 h-12 rounded-lg bg-dark-bg text-gray-400 font-semibold hover:bg-dark-border transition" data-active="false">D</button>
                            </div>
                        </div>

                        <div class="mt-6">
                            <button onclick="saveTradingSchedule()" class="w-full bg-accent-cyan hover:bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg transition">
                                Guardar Horario
                            </button>
                        </div>
                    </div>

                    <!-- Contract Management -->
                    <div class="bg-dark-card border border-dark-border rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4">Gesti칩n de Contratos</h3>

                        <div class="relative mb-4">
                            <span class="material-symbols-outlined absolute left-3 top-2.5 text-gray-400">search</span>
                            <input
                                id="contract-search-input"
                                type="text"
                                placeholder="Buscar contratos (ej. ES, NQ, BTC)"
                                oninput="searchContractsInput()"
                                class="w-full bg-dark-bg text-white rounded-lg pl-10 pr-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none"
                            />
                        </div>

                        <!-- Resultados de b칰squeda -->
                        <div id="contract-search-results" class="space-y-2 mb-4">
                            <!-- Los resultados de b칰squeda aparecer치n aqu칤 -->
                        </div>

                        <!-- Contratos Activos -->
                        <div class="mt-6">
                            <h4 class="text-lg font-semibold mb-3">Contratos Activos</h4>
                            <div id="active-contracts-list" class="space-y-2">
                                <div class="text-center py-6 text-gray-400">
                                    <span class="material-symbols-outlined text-4xl mb-2">inbox</span>
                                    <p class="text-sm">No hay contratos activos</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="space-y-6">
                    <!-- Bot Status -->
                    <div class="bg-dark-card border border-dark-border rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4">Estado del Bot</h3>
                        <div class="flex items-center justify-between p-4 bg-dark-bg rounded-lg">
                            <p class="text-gray-300">El bot est치 actualmente inactivo.</p>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="bot-toggle" class="sr-only peer" onchange="toggleBot()">
                                <div class="w-14 h-8 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[4px] after:left-[4px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-accent-cyan"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Bot Configuration -->
                    <div class="bg-dark-card border border-dark-border rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4">Configuraci칩n del Bot IA</h3>

                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div>
                                <label class="text-gray-400 text-sm block mb-2">Timeframe</label>
                                <select class="w-full bg-dark-bg text-white rounded-lg px-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none">
                                    <option>1 minuto</option>
                                    <option selected>5 minutos</option>
                                    <option>15 minutos</option>
                                    <option>1 hora</option>
                                </select>
                            </div>
                            <div>
                                <label class="text-gray-400 text-sm block mb-2">Se침ales en paralelo</label>
                                <input type="number" value="3" min="1" max="10" class="w-full bg-dark-bg text-white rounded-lg px-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none"/>
                            </div>
                        </div>

                        <!-- Risk Management -->
                        <div class="mb-4">
                            <div class="flex items-center justify-between mb-3 cursor-pointer">
                                <h4 class="text-lg font-semibold">Gesti칩n de Riesgo</h4>
                                <span class="material-symbols-outlined">expand_more</span>
                            </div>
                            <div class="space-y-3">
                                <div>
                                    <label class="text-gray-400 text-sm block mb-2">Stop Loss (%)</label>
                                    <input type="number" value="1.5" step="0.1" class="w-full bg-dark-bg text-white rounded-lg px-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none"/>
                                </div>
                                <div>
                                    <label class="text-gray-400 text-sm block mb-2">Take Profit (%)</label>
                                    <input type="number" value="3.0" step="0.1" class="w-full bg-dark-bg text-white rounded-lg px-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none"/>
                                </div>
                                <div>
                                    <label class="text-gray-400 text-sm block mb-2">M치ximo Drawdown Diario ($)</label>
                                    <input type="number" value="500" step="50" class="w-full bg-dark-bg text-white rounded-lg px-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none"/>
                                </div>
                            </div>
                        </div>

                        <!-- Strategy Parameters -->
                        <div>
                            <div class="flex items-center justify-between cursor-pointer">
                                <h4 class="text-lg font-semibold">Par치metros de Estrategia</h4>
                                <span class="material-symbols-outlined">expand_more</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Backtest Module -->
        <div id="module-backtest" class="module-hidden">
            <!-- Configuration -->
            <div class="bg-dark-card border border-dark-border rounded-xl p-6 mb-6">
                <h3 class="text-xl font-bold mb-4">Configuraci칩n de Backtest</h3>

                <!-- Contract Search & Date Selection -->
                <div class="grid grid-cols-1 gap-4 mb-6">
                    <div>
                        <label class="text-gray-400 text-sm block mb-2">Buscar Contrato</label>
                        <div class="relative">
                            <span class="material-symbols-outlined absolute left-3 top-2.5 text-gray-400">search</span>
                            <input
                                id="backtest-contract-search"
                                type="text"
                                placeholder="Buscar contrato (ej. ES, NQ, BTC)..."
                                oninput="searchBacktestContracts()"
                                class="w-full bg-dark-bg text-white rounded-lg pl-10 pr-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none"
                            />
                        </div>
                        <!-- Resultados de b칰squeda -->
                        <div id="backtest-contract-results" class="mt-2 space-y-1 max-h-60 overflow-y-auto">
                            <!-- Los resultados aparecer치n aqu칤 -->
                        </div>
                        <!-- Contrato seleccionado -->
                        <div id="backtest-selected-contract" class="mt-2 hidden">
                            <div class="flex items-center justify-between p-3 bg-accent-cyan/20 border border-accent-cyan rounded-lg">
                                <div class="flex-1">
                                    <p class="font-semibold text-white" id="backtest-selected-contract-name"></p>
                                    <p class="text-sm text-gray-400" id="backtest-selected-contract-id"></p>
                                </div>
                                <button onclick="clearBacktestContractSelection()" class="text-gray-400 hover:text-white">
                                    <span class="material-symbols-outlined">close</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <label class="text-gray-400 text-sm block mb-2">Fecha Inicio</label>
                            <input type="date" id="backtest-start-date" class="w-full bg-dark-bg text-white rounded-lg px-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none"/>
                        </div>
                        <div>
                            <label class="text-gray-400 text-sm block mb-2">Fecha Fin</label>
                            <input type="date" id="backtest-end-date" class="w-full bg-dark-bg text-white rounded-lg px-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none"/>
                        </div>
                        <div>
                            <label class="text-gray-400 text-sm block mb-2">Timeframe</label>
                            <select id="backtest-timeframe" class="w-full bg-dark-bg text-white rounded-lg px-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none">
                                <option value="1">1 minuto</option>
                                <option value="5" selected>5 minutos</option>
                                <option value="15">15 minutos</option>
                                <option value="30">30 minutos</option>
                                <option value="60">1 hora</option>
                                <option value="240">4 horas</option>
                                <option value="1440">1 d칤a</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Risk Management Parameters -->
                <div class="grid grid-cols-1 gap-4 mb-6">
                    <div class="bg-dark-bg rounded-lg p-4 border border-dark-border">
                        <h4 class="text-md font-semibold mb-3 text-white">Gesti칩n de Riesgo</h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-gray-400 text-sm block mb-2">Stop Loss (USD)</label>
                                <input type="number" id="backtest-stop-loss" value="150" min="0" step="10" class="w-full bg-dark-card text-white rounded-lg px-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none"/>
                                <p class="text-xs text-gray-500 mt-1">Dejar en 0 para desactivar</p>
                            </div>
                            <div>
                                <label class="text-gray-400 text-sm block mb-2">Take Profit (USD)</label>
                                <input type="number" id="backtest-take-profit" value="300" min="0" step="10" class="w-full bg-dark-card text-white rounded-lg px-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none"/>
                                <p class="text-xs text-gray-500 mt-1">Dejar en 0 para desactivar</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Strategy Mode Selection -->
                <div class="mb-6">
                    <label class="text-gray-400 text-sm block mb-3">Modo de Estrategia</label>
                    <div class="flex gap-3">
                        <button onclick="setBacktestMode('model')" id="mode-model" class="flex-1 px-4 py-3 bg-dark-bg text-gray-400 rounded-lg hover:bg-dark-border transition border border-dark-border">
                            <span class="material-symbols-outlined block text-2xl mb-1">psychology</span>
                            <span class="text-sm font-medium">Solo Modelo RL</span>
                        </button>
                        <button onclick="setBacktestMode('combined')" id="mode-combined" class="flex-1 px-4 py-3 bg-accent-cyan text-white rounded-lg transition border border-accent-cyan">
                            <span class="material-symbols-outlined block text-2xl mb-1">hub</span>
                            <span class="text-sm font-medium">Modelo + Indicadores</span>
                        </button>
                        <button onclick="setBacktestMode('indicators')" id="mode-indicators" class="flex-1 px-4 py-3 bg-dark-bg text-gray-400 rounded-lg hover:bg-dark-border transition border border-dark-border">
                            <span class="material-symbols-outlined block text-2xl mb-1">monitoring</span>
                            <span class="text-sm font-medium">Solo Indicadores</span>
                        </button>
                    </div>
                </div>

                <!-- Indicators Configuration -->
                <div id="indicators-config" class="mb-6">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-lg font-semibold">Indicadores T칠cnicos</h4>
                        <button onclick="toggleIndicatorsConfig()" class="text-sm text-accent-cyan hover:text-accent-cyan/80">
                            <span id="indicators-toggle-icon" class="material-symbols-outlined">expand_more</span>
                        </button>
                    </div>

                    <div id="indicators-config-panel" class="space-y-4">
                        <!-- SMI -->
                        <div class="bg-dark-bg rounded-lg p-4 border border-dark-border">
                            <label class="flex items-center gap-2 mb-3">
                                <input type="checkbox" id="use-smi" class="w-4 h-4 accent-cyan-500"/>
                                <span class="font-medium">SMI (Stochastic Momentum Index)</span>
                            </label>
                            <div id="smi-params" class="space-y-3 ml-6 hidden">
                                <div class="grid grid-cols-3 gap-3">
                                    <div>
                                        <label class="text-xs text-gray-400">K Period</label>
                                        <input type="number" id="smi-k-period" value="8" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                    </div>
                                    <div>
                                        <label class="text-xs text-gray-400">D Smoothing</label>
                                        <input type="number" id="smi-d-period" value="3" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                    </div>
                                    <div>
                                        <label class="text-xs text-gray-400">Signal Period</label>
                                        <input type="number" id="smi-smooth" value="3" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-3 bg-dark-card p-3 rounded border border-accent-cyan/30">
                                    <div>
                                        <label class="text-xs text-accent-cyan font-medium">游댵 Sobreventa (LONG)</label>
                                        <input type="number" id="smi-oversold" value="-40" max="0" class="w-full bg-dark-bg text-white rounded px-2 py-1 text-sm border border-dark-border mt-1"/>
                                        <p class="text-xs text-gray-500 mt-1">Cruce alcista desde aqu칤</p>
                                    </div>
                                    <div>
                                        <label class="text-xs text-accent-pink font-medium">游댴 Sobrecompra (SHORT)</label>
                                        <input type="number" id="smi-overbought" value="40" min="0" class="w-full bg-dark-bg text-white rounded px-2 py-1 text-sm border border-dark-border mt-1"/>
                                        <p class="text-xs text-gray-500 mt-1">Cruce bajista desde aqu칤</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- StochRSI -->
                        <div class="bg-dark-bg rounded-lg p-4 border border-dark-border">
                            <label class="flex items-center gap-2 mb-3">
                                <input type="checkbox" id="use-stochrsi" class="w-4 h-4 accent-cyan-500"/>
                                <span class="font-medium">Stochastic RSI</span>
                            </label>
                            <div id="stochrsi-params" class="space-y-3 ml-6 hidden">
                                <div class="grid grid-cols-4 gap-3">
                                    <div>
                                        <label class="text-xs text-gray-400">RSI Period</label>
                                        <input type="number" id="stochrsi-rsi-period" value="14" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                    </div>
                                    <div>
                                        <label class="text-xs text-gray-400">Stoch Period</label>
                                        <input type="number" id="stochrsi-stoch-period" value="14" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                    </div>
                                    <div>
                                        <label class="text-xs text-gray-400">K Smooth</label>
                                        <input type="number" id="stochrsi-k" value="3" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                    </div>
                                    <div>
                                        <label class="text-xs text-gray-400">D Smooth</label>
                                        <input type="number" id="stochrsi-d" value="3" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 gap-3 bg-dark-card p-3 rounded border border-accent-cyan/30">
                                    <div>
                                        <label class="text-xs text-accent-cyan font-medium">游댵 Sobreventa (LONG)</label>
                                        <input type="number" id="stochrsi-oversold" value="20" min="0" max="100" class="w-full bg-dark-bg text-white rounded px-2 py-1 text-sm border border-dark-border mt-1"/>
                                        <p class="text-xs text-gray-500 mt-1">K cruza D hacia arriba desde aqu칤</p>
                                    </div>
                                    <div>
                                        <label class="text-xs text-accent-pink font-medium">游댴 Sobrecompra (SHORT)</label>
                                        <input type="number" id="stochrsi-overbought" value="80" min="0" max="100" class="w-full bg-dark-bg text-white rounded px-2 py-1 text-sm border border-dark-border mt-1"/>
                                        <p class="text-xs text-gray-500 mt-1">K cruza D hacia abajo desde aqu칤</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- MACD -->
                        <div class="bg-dark-bg rounded-lg p-4 border border-dark-border">
                            <label class="flex items-center gap-2 mb-3">
                                <input type="checkbox" id="use-macd" class="w-4 h-4 accent-cyan-500"/>
                                <span class="font-medium">MACD</span>
                            </label>
                            <div id="macd-params" class="grid grid-cols-3 gap-3 ml-6 hidden">
                                <div>
                                    <label class="text-xs text-gray-400">Fast Period</label>
                                    <input type="number" id="macd-fast" value="12" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">Slow Period</label>
                                    <input type="number" id="macd-slow" value="26" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">Signal Period</label>
                                    <input type="number" id="macd-signal" value="9" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                </div>
                            </div>
                        </div>

                        <!-- Bollinger Bands -->
                        <div class="bg-dark-bg rounded-lg p-4 border border-dark-border">
                            <label class="flex items-center gap-2 mb-3">
                                <input type="checkbox" id="use-bb" class="w-4 h-4 accent-cyan-500"/>
                                <span class="font-medium">Bollinger Bands</span>
                            </label>
                            <div id="bb-params" class="grid grid-cols-2 gap-3 ml-6 hidden">
                                <div>
                                    <label class="text-xs text-gray-400">Period</label>
                                    <input type="number" id="bb-period" value="20" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">Std Dev</label>
                                    <input type="number" id="bb-std-dev" value="2.0" min="0.1" step="0.1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                </div>
                            </div>
                        </div>

                        <!-- KDJ -->
                        <div class="bg-dark-bg rounded-lg p-4 border border-dark-border">
                            <label class="flex items-center gap-2 mb-3">
                                <input type="checkbox" id="use-kdj" class="w-4 h-4 accent-cyan-500"/>
                                <span class="font-medium">KDJ</span>
                            </label>
                            <div id="kdj-params" class="grid grid-cols-3 gap-3 ml-6 hidden">
                                <div>
                                    <label class="text-xs text-gray-400">K Period</label>
                                    <input type="number" id="kdj-k-period" value="9" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">D Period</label>
                                    <input type="number" id="kdj-d-period" value="3" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">J Period</label>
                                    <input type="number" id="kdj-j-period" value="3" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                </div>
                            </div>
                        </div>

                        <!-- MA Doble -->
                        <div class="bg-dark-bg rounded-lg p-4 border border-dark-border">
                            <label class="flex items-center gap-2 mb-3">
                                <input type="checkbox" id="use-ma" class="w-4 h-4 accent-cyan-500"/>
                                <span class="font-medium">MA Doble (Moving Average)</span>
                            </label>
                            <div id="ma-params" class="grid grid-cols-2 gap-3 ml-6 hidden">
                                <div>
                                    <label class="text-xs text-gray-400">MA R치pida</label>
                                    <input type="number" id="ma-fast" value="10" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">MA Lenta</label>
                                    <input type="number" id="ma-slow" value="30" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                </div>
                            </div>
                        </div>

                        <!-- CCI -->
                        <div class="bg-dark-bg rounded-lg p-4 border border-dark-border">
                            <label class="flex items-center gap-2 mb-3">
                                <input type="checkbox" id="use-cci" class="w-4 h-4 accent-cyan-500"/>
                                <span class="font-medium">CCI (Commodity Channel Index)</span>
                            </label>
                            <div id="cci-params" class="grid grid-cols-2 gap-3 ml-6 hidden">
                                <div>
                                    <label class="text-xs text-gray-400">Period</label>
                                    <input type="number" id="cci-period" value="20" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-400">Constant</label>
                                    <input type="number" id="cci-constant" value="0.015" min="0.001" step="0.001" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                </div>
                            </div>
                        </div>

                        <!-- ROC -->
                        <div class="bg-dark-bg rounded-lg p-4 border border-dark-border">
                            <label class="flex items-center gap-2 mb-3">
                                <input type="checkbox" id="use-roc" class="w-4 h-4 accent-cyan-500"/>
                                <span class="font-medium">ROC (Rate of Change)</span>
                            </label>
                            <div id="roc-params" class="grid grid-cols-1 gap-3 ml-6 hidden">
                                <div>
                                    <label class="text-xs text-gray-400">Period</label>
                                    <input type="number" id="roc-period" value="12" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                </div>
                            </div>
                        </div>

                        <!-- ATR -->
                        <div class="bg-dark-bg rounded-lg p-4 border border-dark-border">
                            <label class="flex items-center gap-2 mb-3">
                                <input type="checkbox" id="use-atr" class="w-4 h-4 accent-cyan-500"/>
                                <span class="font-medium">ATR (Average True Range)</span>
                            </label>
                            <div id="atr-params" class="grid grid-cols-1 gap-3 ml-6 hidden">
                                <div>
                                    <label class="text-xs text-gray-400">Period</label>
                                    <input type="number" id="atr-period" value="14" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                </div>
                            </div>
                        </div>

                        <!-- WR -->
                        <div class="bg-dark-bg rounded-lg p-4 border border-dark-border">
                            <label class="flex items-center gap-2 mb-3">
                                <input type="checkbox" id="use-wr" class="w-4 h-4 accent-cyan-500"/>
                                <span class="font-medium">WR (Williams %R)</span>
                            </label>
                            <div id="wr-params" class="grid grid-cols-1 gap-3 ml-6 hidden">
                                <div>
                                    <label class="text-xs text-gray-400">Period</label>
                                    <input type="number" id="wr-period" value="14" min="1" class="w-full bg-dark-card text-white rounded px-2 py-1 text-sm border border-dark-border"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Strategy Management -->
                <div class="mb-6 flex gap-3">
                    <div class="flex-1">
                        <label class="text-gray-400 text-sm block mb-2">Cargar Estrategia</label>
                        <select id="load-strategy-selector" onchange="loadStrategyConfig()" class="w-full bg-dark-bg text-white rounded-lg px-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none">
                            <option value="">Nueva estrategia...</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label class="text-gray-400 text-sm block mb-2">Nombre de Estrategia</label>
                        <input type="text" id="strategy-name-input" placeholder="Mi estrategia" class="w-full bg-dark-bg text-white rounded-lg px-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none"/>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex gap-3">
                    <button onclick="saveBacktestStrategy()" class="flex-1 bg-dark-bg hover:bg-dark-border text-white font-medium py-3 px-6 rounded-lg transition flex items-center justify-center gap-2 border border-dark-border">
                        <span class="material-symbols-outlined">save</span>
                        Guardar Estrategia
                    </button>
                    <button onclick="executeBacktest()" class="flex-1 bg-accent-cyan hover:bg-cyan-600 text-white font-bold py-3 px-6 rounded-lg transition flex items-center justify-center gap-2">
                        <span class="material-symbols-outlined">play_arrow</span>
                        Ejecutar Backtest
                    </button>
                </div>
            </div>

            <!-- Results -->
            <div id="backtest-results" class="bg-dark-card border border-dark-border rounded-xl p-6 mb-6 hidden">
                <h3 class="text-xl font-bold mb-4">Resultados del Backtest</h3>
                <p id="backtest-results-title" class="text-gray-400 text-sm mb-6"></p>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                    <div>
                        <p class="text-gray-400 text-sm mb-1">Beneficio / P칠rdida Total</p>
                        <p id="backtest-total-pnl" class="text-2xl font-bold">$0.00</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-sm mb-1">% de Acierto</p>
                        <p id="backtest-win-rate" class="text-2xl font-bold">0%</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-sm mb-1">Profit Factor</p>
                        <p id="backtest-profit-factor" class="text-2xl font-bold">0.00</p>
                    </div>
                    <div>
                        <p class="text-gray-400 text-sm mb-1">Drawdown M치ximo</p>
                        <p id="backtest-max-drawdown" class="text-2xl font-bold text-red-500">0%</p>
                    </div>
                </div>

                <!-- Equity Curve -->
                <div class="mb-8">
                    <h4 class="text-lg font-semibold mb-4">Curva de Capital</h4>
                    <div class="bg-gradient-to-br from-cyan-500/20 to-blue-500/20 rounded-lg p-6" style="height: 250px;">
                        <canvas id="equity-curve"></canvas>
                    </div>
                </div>

                <!-- Gr치fico de Velas con Indicadores -->
                <div id="candlestick-chart-container" class="mb-8 hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-lg font-semibold">Gr치fico de Trading</h4>
                        <div class="flex gap-2">
                            <button onclick="toggleIndicator('smi')" id="toggle-smi" class="px-3 py-1 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded-lg transition">
                                SMI
                            </button>
                            <button onclick="toggleIndicator('stochrsi')" id="toggle-stochrsi" class="px-3 py-1 bg-pink-600 hover:bg-pink-700 text-white text-sm rounded-lg transition">
                                StochRSI
                            </button>
                            <button onclick="toggleIndicator('macd')" id="toggle-macd" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-lg transition">
                                MACD
                            </button>
                        </div>
                    </div>
                    <div class="bg-dark-bg rounded-lg border border-dark-border overflow-hidden">
                        <div id="candlestick-chart" style="height: 600px; width: 100%;"></div>
                    </div>
                    <div class="mt-2 text-xs text-gray-500 text-center">
                        游릭 = Entrada LONG | 游댮 = Entrada SHORT | 拘勇 = Salida con ganancia | 拘勇 = Salida con p칠rdida<br>
                        <span class="text-red-500">- - - L칤nea roja = Stop Loss</span> | <span class="text-green-500">- - - L칤nea verde = Take Profit</span>
                    </div>
                </div>
            </div>

            <div id="backtest-no-results" class="bg-dark-card border border-dark-border rounded-xl p-6 mb-6">
                <div class="text-center py-8">
                    <span class="material-symbols-outlined text-6xl text-gray-600 mb-4">query_stats</span>
                    <h3 class="text-xl font-bold mb-2">No hay resultados de backtest</h3>
                    <p class="text-gray-400">Configure los par치metros arriba y presione "Ejecutar Backtest"</p>
                </div>
            </div>

            <!-- Trade History del Backtest -->
            <div id="backtest-trades" class="bg-dark-card border border-dark-border rounded-xl p-6 hidden">
                <h3 class="text-xl font-bold mb-4">Historial de Operaciones del Backtest</h3>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-left text-gray-400 text-sm border-b border-dark-border">
                                <th class="pb-4 font-medium">ACTIVO</th>
                                <th class="pb-4 font-medium">FECHA ENTRADA</th>
                                <th class="pb-4 font-medium">TIPO</th>
                                <th class="pb-4 font-medium">PRECIO ENTRADA</th>
                                <th class="pb-4 font-medium">PRECIO SALIDA</th>
                                <th class="pb-4 font-medium">RESULTADO ($)</th>
                                <th class="pb-4 font-medium">RESULTADO (%)</th>
                            </tr>
                        </thead>
                        <tbody id="backtest-trades-table" class="text-sm">
                            <tr>
                                <td colspan="7" class="py-8 text-center text-gray-400">No hay trades para mostrar</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Config Module -->
        <div id="module-config" class="module-hidden">
            <div class="max-w-4xl space-y-6">
                <!-- User Info -->
                <div class="bg-dark-card border border-dark-border rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-2">Informaci칩n de Usuario</h3>
                    <p class="text-gray-400 text-sm mb-4">Tu informaci칩n de cuenta actual.</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="text-gray-300 text-sm font-medium block mb-2">Usuario Actual</label>
                            <input type="text" id="current-user-display" readonly class="w-full bg-dark-bg text-gray-400 rounded-lg px-4 py-3 border border-dark-border cursor-not-allowed" value="Cargando..."/>
                        </div>
                        <div>
                            <label class="text-gray-300 text-sm font-medium block mb-2">Email</label>
                            <input type="text" id="current-email-display" readonly class="w-full bg-dark-bg text-gray-400 rounded-lg px-4 py-3 border border-dark-border cursor-not-allowed" value="Cargando..."/>
                        </div>
                    </div>
                </div>

                <!-- TopstepX Connection -->
                <div class="bg-dark-card border border-dark-border rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-2">Conexi칩n a TopstepX</h3>
                    <p class="text-gray-400 text-sm mb-4">Configura tu API Key de TopstepX para operar.</p>

                    <div class="mb-4">
                        <label class="text-gray-300 text-sm font-medium block mb-2">Usuario de TopstepX</label>
                        <input type="text" id="config-topstep-username" placeholder="usuario@email.com" class="w-full bg-dark-bg text-white rounded-lg px-4 py-3 border border-dark-border focus:border-accent-cyan focus:outline-none"/>
                    </div>

                    <div class="mb-4">
                        <label class="text-gray-300 text-sm font-medium block mb-2">TopstepX API Key</label>
                        <div class="relative">
                            <input type="password" id="config-api-key" placeholder="뮉뮉뮉뮉뮉뮉뮉뮉뮉뮉뮉뮉뮉뮉뮉" class="w-full bg-dark-bg text-white rounded-lg px-4 py-3 pr-12 border border-dark-border focus:border-accent-cyan focus:outline-none"/>
                            <button onclick="toggleApiKeyVisibility()" class="absolute right-3 top-3 text-gray-400 hover:text-white">
                                <span id="api-key-visibility-icon" class="material-symbols-outlined">visibility</span>
                            </button>
                        </div>
                    </div>

                    <!-- Estado de conexi칩n -->
                    <div id="topstep-connection-indicator" class="mb-4 p-4 rounded-lg bg-dark-bg border border-dark-border hidden">
                        <div class="flex items-center gap-3">
                            <div id="topstep-status-icon" class="w-3 h-3 rounded-full bg-red-500"></div>
                            <div>
                                <p id="topstep-status-text" class="font-medium">Desconectado</p>
                                <p id="topstep-account-info" class="text-sm text-gray-400"></p>
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-3">
                        <button onclick="testTopstepConnection()" class="bg-gray-700 hover:bg-gray-600 text-white font-medium py-2 px-6 rounded-lg transition">
                            Probar Conexi칩n
                        </button>
                        <button id="topstep-connect-btn" onclick="toggleTopstepConnection()" class="bg-accent-cyan hover:bg-cyan-600 text-white font-medium py-2 px-6 rounded-lg transition">
                            <span id="topstep-connect-btn-text">Conectar</span>
                        </button>
                    </div>

                    <div id="topstep-connection-status" class="mt-4 p-4 rounded-lg hidden">
                        <p id="topstep-connection-message" class="text-sm"></p>
                    </div>
                </div>

                <!-- Notifications -->
                <div class="bg-dark-card border border-dark-border rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-2">Notificaciones</h3>
                    <p class="text-gray-400 text-sm mb-4">Elige c칩mo y cu치ndo quieres recibir notificaciones.</p>

                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-4 bg-dark-bg rounded-lg">
                            <div>
                                <p class="font-medium">Notificaciones por email</p>
                                <p class="text-sm text-gray-400">Recibe res칰menes y alertas importantes en tu correo.</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" checked class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent-cyan"></div>
                            </label>
                        </div>

                        <div class="flex items-center justify-between p-4 bg-dark-bg rounded-lg">
                            <div>
                                <p class="font-medium">Notificaciones push</p>
                                <p class="text-sm text-gray-400">Recibe alertas en tiempo real en tu dispositivo.</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent-cyan"></div>
                            </label>
                        </div>

                        <div class="flex items-center justify-between p-4 bg-dark-bg rounded-lg">
                            <div>
                                <p class="font-medium">Sonido en notificaciones</p>
                                <p class="text-sm text-gray-400">Activa alertas sonoras para operaciones importantes.</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" checked class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent-cyan"></div>
                            </label>
                        </div>
                    </div>

                    <button class="mt-4 bg-accent-cyan hover:bg-cyan-600 text-white font-medium py-2 px-6 rounded-lg transition">
                        Guardar Cambios
                    </button>
                </div>

                <!-- Interface Preferences -->
                <div class="bg-dark-card border border-dark-border rounded-xl p-6">
                    <h3 class="text-xl font-bold mb-2">Preferencias de Interfaz</h3>
                    <p class="text-gray-400 text-sm mb-4">Personaliza la interfaz de la aplicaci칩n a tu gusto.</p>

                    <div class="mb-6">
                        <label class="text-gray-300 text-sm font-medium block mb-3">Tema</label>
                        <div class="grid grid-cols-3 gap-3">
                            <button class="p-4 bg-dark-bg border-2 border-dark-border rounded-lg hover:border-accent-cyan transition text-center">
                                <span class="material-symbols-outlined text-2xl mb-2">light_mode</span>
                                <p class="text-sm">Claro</p>
                            </button>
                            <button class="p-4 bg-dark-bg border-2 border-accent-cyan rounded-lg text-center">
                                <span class="material-symbols-outlined text-2xl mb-2">dark_mode</span>
                                <p class="text-sm">Oscuro</p>
                            </button>
                            <button class="p-4 bg-dark-bg border-2 border-dark-border rounded-lg hover:border-accent-cyan transition text-center">
                                <span class="material-symbols-outlined text-2xl mb-2">computer</span>
                                <p class="text-sm">Sistema</p>
                            </button>
                        </div>
                    </div>

                    <button class="bg-accent-cyan hover:bg-cyan-600 text-white font-medium py-2 px-6 rounded-lg transition">
                        Guardar Cambios
                    </button>
                </div>

                <!-- Bot Options & General Options -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-dark-card border border-dark-border rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4">Opciones del Bot</h3>
                        <p class="text-gray-400 text-sm mb-4">Ajusta los par치metros del bot de trading.</p>

                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium">Activar trading autom치tico</p>
                                    <p class="text-sm text-gray-400">El bot operar치 autom치ticamente</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" checked class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent-cyan"></div>
                                </label>
                            </div>

                            <div>
                                <label class="text-gray-300 text-sm font-medium block mb-2">Nivel de Riesgo</label>
                                <select class="w-full bg-dark-bg text-white rounded-lg px-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none">
                                    <option>Conservador</option>
                                    <option selected>Moderado</option>
                                    <option>Agresivo</option>
                                </select>
                            </div>

                            <div>
                                <label class="text-gray-300 text-sm font-medium block mb-2">Estrategia Preferida</label>
                                <select class="w-full bg-dark-bg text-white rounded-lg px-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none">
                                    <option selected>Momentum</option>
                                    <option>Mean Reversion</option>
                                    <option>Trend Following</option>
                                </select>
                            </div>
                        </div>

                        <button class="mt-4 w-full bg-accent-cyan hover:bg-cyan-600 text-white font-medium py-2 px-4 rounded-lg transition">
                            Guardar Cambios
                        </button>
                    </div>

                    <div class="bg-dark-card border border-dark-border rounded-xl p-6">
                        <h3 class="text-xl font-bold mb-4">Opciones Generales</h3>
                        <p class="text-gray-400 text-sm mb-4">Configuraciones generales de la aplicaci칩n.</p>

                        <div class="space-y-4">
                            <div>
                                <label class="text-gray-300 text-sm font-medium block mb-2">Idioma</label>
                                <select class="w-full bg-dark-bg text-white rounded-lg px-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none">
                                    <option selected>Espa침ol</option>
                                    <option>English</option>
                                    <option>Portugu칡s</option>
                                </select>
                            </div>

                            <div>
                                <label class="text-gray-300 text-sm font-medium block mb-2">Densidad de la interfaz</label>
                                <select class="w-full bg-dark-bg text-white rounded-lg px-4 py-2 border border-dark-border focus:border-accent-cyan focus:outline-none">
                                    <option>Compacta</option>
                                    <option selected>C칩moda</option>
                                    <option>Espaciosa</option>
                                </select>
                            </div>
                        </div>

                        <button class="mt-4 w-full bg-accent-cyan hover:bg-cyan-600 text-white font-medium py-2 px-4 rounded-lg transition">
                            Guardar Cambios
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<script src="notifications.js"></script>
<script src="app.js"></script>
</body>
</html>
